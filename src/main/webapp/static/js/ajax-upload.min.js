/**
 * AJAX Upload ( http://valums.com/ajax-upload/ ) 
 * Copyright (c) Andris Valums
 * Licensed under the MIT license ( http://valums.com/mit-license/ )
 * Thanks to Gary Haran, David Mark, Corey Burns and others for contributions 
 */(function(){function g(a,b,c){if(a.addEventListener)a.addEventListener(b,c,!1);else if(a.attachEvent)a.attachEvent("on"+b,function(){c.call(a)});else throw Error("not supported or DOM not loaded");}function m(a,b){for(var c in b)b.hasOwnProperty(c)&&(a.style[c]=b[c])}function l(a,b){a.className=a.className.replace(RegExp("\\b"+b+"\\b"),"")}function k(a){a.parentNode.removeChild(a)}var p=document.documentElement.getBoundingClientRect?function(a){var b=a.getBoundingClientRect(),c=a.ownerDocument;a=
c.body;var c=c.documentElement,e=c.clientTop||a.clientTop||0,h=c.clientLeft||a.clientLeft||0,d=1;a.getBoundingClientRect&&(d=a.getBoundingClientRect(),d=(d.right-d.left)/a.clientWidth);1<d&&(h=e=0);return{top:b.top/d+(window.pageYOffset||c&&c.scrollTop/d||a.scrollTop/d)-e,left:b.left/d+(window.pageXOffset||c&&c.scrollLeft/d||a.scrollLeft/d)-h}}:function(a){var b=0,c=0;do b+=a.offsetTop||0,c+=a.offsetLeft||0,a=a.offsetParent;while(a);return{left:c,top:b}},n=function(){var a=document.createElement("div");
return function(b){a.innerHTML=b;return a.removeChild(a.firstChild)}}(),q=function(){var a=0;return function(){return"ValumsAjaxUpload"+a++}}();window.AjaxUpload=function(a,b){this._settings={offsetTop:0,offsetLeft:0,action:"upload.php",name:"userfile",data:{},autoSubmit:!0,responseType:!1,hoverClass:"hover",disabledClass:"disabled",onChange:function(a,b){},onSubmit:function(a,b){},onComplete:function(a,b){}};for(var c in b)b.hasOwnProperty(c)&&(this._settings[c]=b[c]);a.jquery?a=a[0]:"string"==typeof a&&
(/^#.*/.test(a)&&(a=a.slice(1)),a=document.getElementById(a));if(!a||1!==a.nodeType)throw Error("Please make sure that you're passing a valid element");"A"==a.nodeName.toUpperCase()&&g(a,"click",function(a){a&&a.preventDefault?a.preventDefault():window.event&&(window.event.returnValue=!1)});this._button=a;this._input=null;this._disabled=!1;this.enable();this._rerouteClicks()};AjaxUpload.prototype={setData:function(a){this._settings.data=a},disable:function(){var a=this._button,b=this._settings.disabledClass;
RegExp("\\b"+b+"\\b").test(a.className)||(a.className+=" "+b);this._disabled=!0;a=this._button.nodeName.toUpperCase();"INPUT"!=a&&"BUTTON"!=a||this._button.setAttribute("disabled","disabled");this._input&&(this._input.parentNode.style.visibility="hidden")},enable:function(){l(this._button,this._settings.disabledClass);this._button.removeAttribute("disabled");this._disabled=!1},_createInput:function(){var a=this,b=document.createElement("input");b.setAttribute("type","file");b.setAttribute("name",
this._settings.name);m(b,{position:"absolute",right:0,margin:0,padding:0,fontSize:"480px",cursor:"pointer"});var c=document.createElement("div");c.setAttribute("id","abcdefg");m(c,{display:"block",position:"absolute",overflow:"hidden",margin:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483583});if("0"!==c.style.opacity){if("undefined"==typeof c.filters)throw Error("Opacity not supported by the browser");c.style.filter="alpha(opacity\x3d0)"}g(b,"change",function(){if(b&&""!==b.value){var c=b.value.replace(/.*(\/|\\)/,
"");!1===a._settings.onChange.call(a,c,-1!==c.indexOf(".")?c.replace(/.*[.]/,""):"")?a._clearInput():a._settings.autoSubmit&&a.submit()}});g(b,"mouseover",function(){var b=a._button,c=a._settings.hoverClass;RegExp("\\b"+c+"\\b").test(b.className)||(b.className+=" "+c)});g(b,"mouseout",function(){l(a._button,a._settings.hoverClass);b.parentNode.style.visibility="hidden"});c.appendChild(b);document.body.appendChild(c);this._input=b},_clearInput:function(){this._input&&(k(this._input.parentNode),this._input=
null,this._createInput(),l(this._button,this._settings.hoverClass))},_rerouteClicks:function(){var a=this;g(a._button,"mouseover",function(){if(!a._disabled){a._input||a._createInput();var b=a._input.parentNode,c=a._button,e=p(c);m(b,{position:"absolute",left:e.left-a._settings.offsetLeft+"px",top:e.top-a._settings.offsetTop+"px",width:c.offsetWidth+"px",height:c.offsetHeight+"px"});b.style.visibility="visible"}})},_createIframe:function(){var a=q(),b=n('\x3ciframe src\x3d"javascript:false;" name\x3d"'+
a+'" /\x3e');b.setAttribute("id",a);b.style.display="none";document.body.appendChild(b);return b},_createForm:function(a){var b=this._settings,c=n('\x3cform method\x3d"post" enctype\x3d"multipart/form-data"\x3e\x3c/form\x3e');c.setAttribute("action",b.action);c.setAttribute("target",a.name);c.style.display="none";document.body.appendChild(c);for(var e in b.data)b.data.hasOwnProperty(e)&&(a=document.createElement("input"),a.setAttribute("type","hidden"),a.setAttribute("name",e),a.setAttribute("value",
b.data[e]),c.appendChild(a));return c},_getResponse:function(a,b){var c=!1,e=this,h=this._settings;g(a,"load",function(){if("javascript:'%3Chtml%3E%3C/html%3E';"==a.src||"javascript:'\x3chtml\x3e\x3c/html\x3e';"==a.src)c&&setTimeout(function(){k(a)},0);else{var d=a.contentDocument?a.contentDocument:window.frames[a.id].document;if(!d.readyState||"complete"==d.readyState)if(!d.body||"false"!=d.body.innerHTML){var f;d.XMLDocument?f=d.XMLDocument:d.body?(f=d.body.innerHTML,h.responseType&&"json"==h.responseType.toLowerCase()&&
(d.body.firstChild&&"PRE"==d.body.firstChild.nodeName.toUpperCase()&&(f=null!=d.body.firstChild.firstChild?d.body.firstChild.firstChild.nodeValue:""),f=f?eval("("+f+")"):{})):f=d;h.onComplete.call(e,b,f);c=!0;a.src="javascript:'\x3chtml\x3e\x3c/html\x3e';"}}})},submit:function(){var a=this._settings;if(this._input&&""!==this._input.value){var b=this._input.value.replace(/.*(\/|\\)/,"");if(!1===a.onSubmit.call(this,b,-1!==b.indexOf(".")?b.replace(/.*[.]/,""):""))this._clearInput();else{var a=this._createIframe(),
c=this._createForm(a);k(this._input.parentNode);l(this._button,this._settings.hoverClass);c.appendChild(this._input);c.submit();k(c);k(this._input);this._input=null;this._getResponse(a,b);this._createInput()}}}}})();